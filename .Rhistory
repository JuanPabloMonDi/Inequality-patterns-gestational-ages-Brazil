tm_shape(estado_mapa) +
tm_borders(fill_alpha = 1) +
tm_text(text = "abbrev_state", size = 0.6)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant",  breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +  tm_legend(text.size = 0.85)  +
tm_borders(fill_alpha= 0.0) +
tm_title(paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ),position = "center", frame = F) +   #tm_layout( frame = F) +
tm_layout(frame = F) +   #tm_layout( frame = F) +
tm_shape(estado_mapa) + tm_borders( alpha= 1) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c(
"white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)
),
labels = c(
"No significativo",
"Alto-Alto",
"Bajo-Bajo",
"Bajo-Alto",
"Alto-Bajo"
)
),
fill.legend = tm_legend(
title = "",
text.size = 0.85
)
) +
tm_borders(fill_alpha = 0.0) +
tm_title(
title = paste0("Moran Local: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
tm_shape(estado_mapa) +
tm_borders(fill_alpha = 1) +
tm_text(
text = "abbrev_state",
size = 0.6
)
#
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c(
"white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)
),
labels = c(
"No significativo",
"Alto-Alto",
"Bajo-Bajo",
"Bajo-Alto",
"Alto-Bajo"
)
),
fill.legend = tm_legend(
title = "",
text.size = 0.85
)
) +
tm_borders(fill_alpha = 0.0) +
tm_title(paste0("Moran Local: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
tm_shape(estado_mapa) +
tm_borders(fill_alpha = 1) +
tm_text(
text = "abbrev_state",
size = 0.6
)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant",  breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +  tm_legend(text.size = 0.85)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant",  breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +  tm_legend(text.size = 0.85)+
tm_borders(alpha= 0.0)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant",  breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +  tm_legend(text.size = 0.85)+
tm_borders(alpha= 0.0)+
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant",  breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +  tm_legend(text.size = 0.85)+
tm_borders(alpha= 0.0)+
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+   #tm_layout( frame = F) +
tm_shape(estado_mapa) + tm_borders( alpha= 1) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F) + #tm_layout( frame = F) +
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa) +
tm_borders(lwd = 1, fill_alpha = 0) +  # Only border lines, no fill
tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa) +
tm_borders(lwd = 1, fill_alpha = 0) +  # Only border lines, no fill
tm_text(text = "abbrev_state", size = 0.6)
library(tmap)
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c("white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)),
labels = c("Not significant", "High-High", "Low-Low", "Low-High", "High-Low")
),
fill.legend = tm_legend(title = "", text.size = 0.85),
border.alpha = 0  # << Hide microregion borders!
) +
tm_title(
title = paste0("Local Moran: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
# Draw only state outlines and abbreviations
tm_shape(estado_mapa) +
tm_borders(lwd = 1, fill_alpha = 0) +
tm_text(text = "abbrev_state", size = 0.6)
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c("white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)),
labels = c("Not significant", "High-High", "Low-Low", "Low-High", "High-Low")
),
fill.legend = tm_legend(title = "", text.size = 0.85),
border.alpha = 0  # << Hide microregion borders!
) +
tm_title( paste0("Local Moran: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
# Draw only state outlines and abbreviations
tm_shape(estado_mapa) +
tm_borders(lwd = 1, fill_alpha = 0) +
tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa) +
tm_borders(lwd = 1, fill_alpha = 0) +  # Only border lines, no fill
tm_text(text = "abbrev_state", size = 0.6)
tm_shape(estado_mapa, border.alpha=1) + tm_borders( alpha= 1) + tm_text(text = "abbrev_state", size = 0.6) dev.off()
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(lwd = 1, fill_alpha = 0) +  # Only border lines, no fill
tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(alpha= 1, fill_alpha = 0) + tm_text(text = "abbrev_state", size = 0.6)
help("tm_borders")
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(alpha= 0,2, fill_alpha = 0) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(alpha= 0.2, fill_alpha = 0) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(fill_alpha = 1) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", border.alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(fill_alpha = 1) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(fill_alpha = 1) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa, border.alpha=1) +
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
#tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa) +
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa)
library(tmap)
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
border.alpha = 0,  # Hides municipal borders (important!)
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c(
"white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)
),
labels = c(
"Not significant",
"High-High",
"Low-Low",
"Low-High",
"High-Low"
)
),
fill.legend = tm_legend(title = "", text.size = 0.85)
) +
tm_title(
title = paste0("Local Moran: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
tm_shape(estado_mapa) +
tm_borders(lwd = 2, fill_alpha = 0) +  # Only state borders
tm_text(text = "abbrev_state", size = 0.6)
library(tmap)
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
border.alpha = 0,  # Hides municipal borders (important!)
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c(
"white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)
),
labels = c(
"Not significant",
"High-High",
"Low-Low",
"Low-High",
"High-Low"
)
),
fill.legend = tm_legend(title = "", text.size = 0.85)
) +
tm_title( paste0("Local Moran: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
tm_shape(estado_mapa) +
tm_borders(lwd = 2, fill_alpha = 0) +  # Only state borders
tm_text(text = "abbrev_state", size = 0.6)
library(tmap)
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
col_alpha = 0,  # Hides municipal borders (important!)
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c(
"white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)
),
labels = c(
"Not significant",
"High-High",
"Low-Low",
"Low-High",
"High-Low"
)
),
fill.legend = tm_legend(title = "", text.size = 0.85)
) +
tm_title(
title = paste0("Local Moran: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
tm_shape(estado_mapa) +
tm_borders(lwd = 2, fill_alpha = 0) +  # Only state borders
tm_text(text = "abbrev_state", size = 0.6)
library(tmap)
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
col_alpha = 0,  # Hides municipal borders (important!)
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c(
"white", "red", "blue",
rgb(0, 0, 1, alpha = 0.4),
rgb(1, 0, 0, alpha = 0.4)
),
labels = c(
"Not significant",
"High-High",
"Low-Low",
"Low-High",
"High-Low"
)
),
fill.legend = tm_legend(title = "", text.size = 0.85)
) +
tm_title(paste0("Local Moran: ", nome_titulo, " ", ano_dado - 2, " - ", ano_dado),
position = "center"
) +
tm_layout(frame = FALSE) +
tm_shape(estado_mapa) +
tm_borders(lwd = 2, fill_alpha = 0) +  # Only state borders
tm_text(text = "abbrev_state", size = 0.6)
border.
tm_shape(lmoran) +
tm_polygons(
col = "quadrant",
border.alpha = 0,  # Hides municipal borders (important!)
fill.scale = tm_scale(
breaks = c(0, 1, 2, 3, 4, 5),
values = c("white", "red", "blue",rgb(0, 0, 1, alpha = 0.4),rgb(1, 0, 0, alpha = 0.4) ),
labels = c( "Not significant", "High-High", "Low-Low","Low-High",    "High-Low"
)
),
fill.legend = tm_legend(title = "", text.size = 0.85)
) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa) +
tm_borders(lwd = 2, fill_alpha = 0) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="") +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0, col_alpha=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa)+
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", col_alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa)+
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
#
tm_shape(lmoran) +
tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", col_alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa)+
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant",  breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", col_alpha=0) +  tm_legend(text.size = 0.85)+
tm_borders(alpha= 0)+
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+   #tm_layout( frame = F) +
tm_shape(estado_mapa) + tm_borders( alpha= 1) + tm_text(text = "abbrev_state", size = 0.6)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", col_alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa)+
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
# Choosing a Year - Generating the Map with Neighbors removing Fernando de Noronha - PE (island)
ano_dado<- 2022 ; moran_dados_ano<-   baixo_peso_br[!(baixo_peso_br$name_micro == "Fernando De Noronha"), ] ; nome_titulo<- "Baixo Peso"
#ano_dado<- 2022 ; moran_dados_ano<- tx_mortalidade[!(tx_mortalidade$name_micro == "Fernando De Noronha"), ] ; nome_titulo<- "Mortalidade"
# Generating neighbors by proximity to the queen (queen true, from chess). Same neighborhood for SGA and Mortality
vizinhos <- poly2nb(moran_dados_ano, queen=TRUE) #; vizinhos[1]
# Weight of neighbors; style = W and normalization by the line
viz_pesos <- nb2listw(vizinhos, style="W", zero.policy=TRUE)
#; viz_pesos$weights[1] ; print.listw(viz_pesos, zero.policy = TRUE)  # Checking
# Moran Global I
eval(parse(text = paste0(" mapa_moran_I <- moran(x = moran_dados_ano$Ano_", ano_dado , ", listw = viz_pesos, n = length(vizinhos), S0 = Szero(viz_pesos), zero.policy = TRUE) ") ))
###  Generating the Local Moran Index
eval(parse(text = paste0(" mapa_moran_local<- localmoran(x = moran_dados_ano$Ano_", ano_dado, ", listw = viz_pesos, adjust.x=TRUE, zero.policy = TRUE)" ) ))
# Saving to a map object
lmoran<- cbind(moran_dados_ano, mapa_moran_local )
# Centers the local Moran around the mean
lmoran$Ii <- lmoran$Ii - mean(lmoran$Ii, na.rm = TRUE)
# The spatial lag value is created (the average of the neighboring values of each weight)
eval(parse(text = paste0(" lmoran$lag.prob8091<- lag.listw(x = viz_pesos, var = lmoran$Ano_", ano_dado, ", zero.policy = TRUE)" )  ))
eval(parse(text = paste0(" lmoran$prob8091.n <- lmoran$Ano_", ano_dado, " - mean(lmoran$Ano_", ano_dado, ", na.rm = TRUE)")  ))  # Centraliza a variável de interesse em torno de sua média
lmoran$lag.prob8091 <- lmoran$lag.prob8091 - mean(lmoran$lag.prob8091, na.rm = TRUE)
# Creating quadrants for values
signif <- 0.05 ; lmoran <- lmoran%>%
mutate(quadrant= ifelse(prob8091.n > 0 & lag.prob8091 > 0, 1, 0)) %>%        ## high-high
mutate(quadrant= ifelse(prob8091.n < 0 & lag.prob8091 < 0, 2, quadrant)) %>% ## low-low
mutate(quadrant= ifelse(prob8091.n < 0 & lag.prob8091 > 0, 3, quadrant)) %>% ## low-high
mutate(quadrant= ifelse(prob8091.n > 0 & lag.prob8091 < 0, 4, quadrant)) %>% ## high-low
mutate(quadrant= ifelse(lmoran$Pr.z....E.Ii.. > signif, 0, quadrant))
# Making a map with areas
#Export plot in pdf format
pdf(paste0("Maps and Tables/",referencia_pig, "_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".pdf"), width = 14, height = 12)
#In case you want to export the jpeg
#jpeg( paste0("Maps and Tables/",referencia_pig,"_Moran Local - ", nome_titulo," Microrregiao ", ano_dado,".jpg"), width = 7, height =5, units = 'in',  res = 400,quality = 100)
tm_shape(lmoran) + tm_fill(col = "quadrant", breaks = c(0, 1, 2, 3, 4, 5) , palette= c("white","red","blue",rgb(0,0,1,alpha=0.4),rgb(1,0,0,alpha=0.4)),
labels = c("Not significant", "High-High","Low-Low","Low-High","High-Low"), title="", col_alpha=0) +
tm_legend(text.size = 0.85) +
tm_borders(fill_alpha= 0.0, lwd=0) +
tm_layout(main.title = paste0("Moran Local: ", nome_titulo," ", ano_dado-2, " - ", ano_dado ), main.title.position = "center", frame = F)+ #tm_layout( frame = F) +
tm_shape(estado_mapa)+
tm_borders(fill_alpha = 1, lwd=2) + tm_text(text = "abbrev_state", size = 0.6)
tm_shape(estado_mapa) + tm_borders( alpha= 1) + tm_text(text = "abbrev_state", size = 0.6)
dev.off()
#
